<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Primary SEO Meta Tags -->
    <title>GymPlan.fit | AI-Powered Custom Workout Plan Generator</title>
    <meta name="description" content="Stop guessing in the gym. Get a science-backed, personalized workout plan in seconds with GymPlan.fit. Tailored to your goals, schedule, and equipment.">
    <meta name="keywords" content="AI workout planner, custom gym plan, personalized fitness plan, workout generator, strength training, fat loss, muscle gain, gym routine, fitness app">
    <link rel="canonical" href="https://gymplan.fit" />

    <!-- Open Graph / Facebook Meta Tags -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://gymplan.fit/">
    <meta property="og:title" content="GymPlan.fit | AI-Powered Custom Workout Plan Generator">
    <meta property="og:description" content="Generate a science-backed, personalized workout plan in seconds. Tailored to your goals, schedule, and equipment.">
    <meta property="og:image" content="https://gymplan.fit/logo.png.png">

    <!-- Twitter Meta Tags -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://gymplan.fit/">
    <meta property="twitter:title" content="GymPlan.fit | AI-Powered Custom Workout Plan Generator">
    <meta property="twitter:description" content="Generate a science-backed, personalized workout plan in seconds. Tailored to your goals, schedule, and equipment.">
    <meta property="twitter:image" content="https://gymplan.fit/logo.png.png">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="logo.png.png">
    <link rel="apple-touch-icon" href="logo.png.png">


    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        html {
            scroll-behavior: smooth; /* Keep this as a fallback */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0a0a;
            color: #e5e5e5;
        }
        .hero-bg {
            background: linear-gradient(rgba(10, 10, 10, 0.8), rgba(10, 10, 10, 1)), url('https://images.unsplash.com/photo-1571902943202-507ec2618e8f?q=80&w=2575&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D') no-repeat center center/cover;
        }
        .btn-primary {
            background-color: #3b82f6; /* Electric Blue */
            transition: all 0.3s ease-in-out;
        }
        .btn-primary:hover {
            background-color: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.25);
        }
        .btn-secondary {
            background-color: #1f2937;
            border: 1px solid #374151;
            transition: all 0.3s ease-in-out;
        }
        .btn-secondary:hover {
            background-color: #374151;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        .form-step {
            display: none;
            animation: slide-and-fade-in 0.5s ease-in-out;
        }
        .form-step.active {
            display: block;
        }
        @keyframes slide-and-fade-in {
            from { opacity: 0; transform: translateY(25px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .feature-card, .plan-card, .nutrition-card {
            background-color: #1f2937;
            border: 1px solid #374151;
            border-radius: 1rem;
            padding: 1.5rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .feature-card:hover, .plan-card:hover, .nutrition-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.2), 0 4px 6px -2px rgba(59, 130, 246, 0.1);
        }
        .progress-bar-inner {
            transition: width 0.5s ease-in-out;
        }
        .loader, .swap-loader {
            border: 4px solid #374151;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        .loader { width: 50px; height: 50px; }
        .swap-loader { width: 20px; height: 20px; }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Style for the form labels */
        form label[for^="day-"], form label[for^="mainGoal-"], form label[for^="subGoal-"], form label[for^="equip-"], form label[for^="diet-"], form label[for^="gender-"] {
            transition: all 0.2s ease-in-out;
        }

        /* Style for the checked state of form inputs */
        input[type="radio"]:checked + label, input[type="checkbox"]:checked + label {
            border-color: #3b82f6;
            background-color: #3b82f620;
            transform: scale(1.02);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.3);
        }
        
        /* Modal Styles */
        .modal-backdrop {
            transition: opacity 0.3s ease-in-out;
        }
        .modal-content {
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }
        .modal-hidden {
            pointer-events: none;
        }
        .modal-hidden .modal-backdrop {
            opacity: 0;
        }
        .modal-hidden .modal-content {
            opacity: 0;
            transform: scale(0.95);
        }
    </style>

        <!-- Preconnect to speed up font loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Theme color for Android Chrome -->
    <meta name="theme-color" content="#0a0a0a">

    <!-- JSON‑LD WebApplication schema for richer SEO -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "GymPlan.fit",
      "url": "https://gymplan.fit",
      "description": "AI‑Powered Custom Workout Plan Generator. Stop guessing in the gym and get a personalized plan in seconds, tailored to your goals, schedule, and equipment.",
      "applicationCategory": "FitnessApplication",
      "operatingSystem": "All",
      "browserRequirements": "Requires JavaScript"
    }
    </script>

    

</head>
<body class="antialiased">

    <!-- Header -->
    <header class="absolute top-0 left-0 right-0 z-10 p-4">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold text-white">Gym<span class="text-blue-500">Plan</span></h1>
            <a href="#plan-generator" onclick="smoothScroll(event)" class="hidden md:inline-block px-6 py-2 font-semibold text-white rounded-lg btn-primary">Build Your Plan</a>
        </div>
    </header>

    <main>
        <!-- Hero Section -->
        <section id="hero" class="hero-bg min-h-screen flex items-center justify-center text-center p-4">
            <div class="max-w-3xl">
                <h2 class="text-4xl md:text-6xl font-black text-white leading-tight mb-4">Stop Guessing. Start Training.</h2>
                <p class="text-lg md:text-xl text-gray-300 mb-6">Get a science-backed, personalized workout plan in seconds. Tailored to your goals, schedule, and equipment.</p>
                <p class="text-md md:text-lg text-blue-400 font-semibold tracking-wider mb-8">No Fluff. Just Your Plan.</p>
                <a href="#plan-generator" onclick="smoothScroll(event)" class="px-10 py-4 text-lg font-bold text-white rounded-lg btn-primary">Build Your Plan Now</a>
            </div>
        </section>

        <!-- Features Section -->
        <section id="features" class="py-20 bg-black">
            <div class="container mx-auto px-4 text-center">
                <h3 class="text-3xl font-bold mb-2">How It Works</h3>
                <p class="text-gray-400 mb-12 max-w-2xl mx-auto">Create your perfect workout plan in three simple steps.</p>
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="feature-card">
                        <div class="text-blue-500 mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                        </div>
                        <h4 class="text-xl font-bold mb-2">1. Tell Us About You</h4>
                        <p class="text-gray-400">Fill out a quick form about your goals, schedule, and what equipment you have.</p>
                    </div>
                    <div class="feature-card">
                        <div class="text-blue-500 mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M12 6V3m0 18v-3m6-6h3m-3 6h3M9 6h6M9 18h6" /></svg>
                        </div>
                        <h4 class="text-xl font-bold mb-2">2. AI-Powered Generation</h4>
                        <p class="text-gray-400">Our AI analyzes your inputs to craft a unique, effective workout plan just for you.</p>
                    </div>
                    <div class="feature-card">
                        <div class="text-blue-500 mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                        </div>
                        <h4 class="text-xl font-bold mb-2">3. Train & Track</h4>
                        <p class="text-gray-400">Receive your plan instantly. Download, print, or start your first workout today.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Plan Generator Form Section -->
        <section id="plan-generator" class="py-20">
            <div class="container mx-auto px-4">
                <div class="max-w-2xl mx-auto bg-[#18181b] p-8 rounded-2xl shadow-2xl">
                    <h2 class="text-3xl font-bold text-center mb-2">Create Your Plan</h2>
                    <p class="text-gray-400 text-center mb-8">Let's build the perfect workout routine for you.</p>

                    <!-- Progress Bar -->
                    <div class="w-full bg-gray-700 rounded-full h-2.5 mb-8">
                        <div id="progress-bar" class="bg-blue-500 h-2.5 rounded-full progress-bar-inner" style="width: 25%"></div>
                    </div>

                    <form id="gymPlanForm">
                        <!-- Step 1: Days & Goal -->
                        <div id="step-1" class="form-step active">
                            <div class="mb-6">
                                <label class="block text-lg font-medium mb-3">How many days per week can you train?</label>
                                <div id="trainingDaysContainer" class="grid grid-cols-3 sm:grid-cols-7 gap-2"></div>
                            </div>
                            <div class="mb-6">
                                <label class="block text-lg font-medium mb-3">What type of plan do you want?</label>
                                <div id="mainGoalContainer" class="grid grid-cols-1 sm:grid-cols-2 gap-3"></div>
                            </div>
                             <div id="subGoalContainer" class="mb-6 mt-4 hidden">
                                <label class="block text-lg font-medium mb-3">Select a style:</label>
                                <div id="subGoalOptions" class="grid grid-cols-1 sm:grid-cols-2 gap-3"></div>
                            </div>
                            <button type="button" onclick="nextStep(2)" class="w-full px-6 py-3 font-semibold text-white rounded-lg btn-primary">Next</button>
                        </div>
                        
                        <!-- Step 2: User Stats -->
                        <div id="step-2" class="form-step">
                            <label class="block text-lg font-medium mb-3">Tell us about yourself</label>
                            <p class="text-sm text-gray-400 mb-4">This helps us calculate more accurate nutrition targets.</p>
                            <div class="mb-6">
                                <label class="block text-sm font-medium mb-2">Gender</label>
                                <div id="genderContainer" class="grid grid-cols-2 gap-3"></div>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div>
                                    <label for="height" class="block text-sm font-medium mb-2">Height (cm)</label>
                                    <input type="number" name="height" id="height" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg" required>
                                </div>
                                <div>
                                    <label for="weight" class="block text-sm font-medium mb-2">Weight (kg)</label>
                                    <input type="number" name="weight" id="weight" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg" required>
                                </div>
                            </div>
                             <div class="flex justify-between">
                                <button type="button" onclick="prevStep(1)" class="px-6 py-3 font-semibold text-white rounded-lg btn-secondary">Back</button>
                                <button type="button" onclick="nextStep(3)" class="px-6 py-3 font-semibold text-white rounded-lg btn-primary">Next</button>
                            </div>
                        </div>

                        <!-- Step 3: Equipment -->
                        <div id="step-3" class="form-step">
                            <label class="block text-lg font-medium mb-3">What equipment do you have access to?</label>
                            <div id="equipmentContainer" class="grid grid-cols-1 sm:grid-cols-3 gap-3 mb-6"></div>
                             <div class="flex justify-between">
                                <button type="button" onclick="prevStep(2)" class="px-6 py-3 font-semibold text-white rounded-lg btn-secondary">Back</button>
                                <button type="button" onclick="nextStep(4)" class="px-6 py-3 font-semibold text-white rounded-lg btn-primary">Next</button>
                            </div>
                        </div>

                        <!-- Step 4: Style & Limitations -->
                        <div id="step-4" class="form-step">
                            <div class="mb-6">
                                <label for="trainingStyle" class="block text-lg font-medium mb-3">Preferred training split (optional)</label>
                                <select id="trainingStyle" name="trainingStyle" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">No Preference</option>
                                    <option value="Push/Pull/Legs">Push/Pull/Legs</option>
                                    <option value="Upper/Lower">Upper/Lower</option>
                                    <option value="Full Body">Full Body</option>
                                    <option value="Body Part Split">Body Part Split</option>
                                </select>
                            </div>
                            <div class="mb-6">
                                <label for="limitations" class="block text-lg font-medium mb-3">Any injuries or limitations? (optional)</label>
                                <textarea id="limitations" name="limitations" rows="4" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., 'Bad lower back, avoid heavy deadlifts'"></textarea>
                            </div>
                            <div class="flex justify-between">
                                <button type="button" onclick="prevStep(3)" class="px-6 py-3 font-semibold text-white rounded-lg btn-secondary">Back</button>
                                <button type="submit" class="w-1/2 px-6 py-3 font-semibold text-white rounded-lg btn-primary">Generate Plan</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </section>

        <!-- Plan Output Section -->
        <section id="plan-output" class="hidden py-20 bg-black">
            <div class="container mx-auto px-4">
                <div id="loader-container" class="text-center">
                    <div class="loader mx-auto"></div>
                    <p class="text-xl font-semibold mt-4">Generating your personalized plan...</p>
                    <p class="text-gray-400">Our AI is crafting the perfect workout for you.</p>
                </div>

                <div id="results-container" class="hidden">
                    <div class="text-center mb-12">
                         <h2 class="text-3xl md:text-4xl font-bold">Your Personalized Gym Plan</h2>
                         <p class="text-gray-400 mt-2 max-w-2xl mx-auto">Here is your AI-generated workout plan. You can edit your inputs or download it.</p>
                    </div>
                   
                    <div id="plan-details" class="grid md:grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-8">
                        <!-- Plan cards will be injected here -->
                    </div>

                     <!-- Nutrition Section -->
                    <div id="nutrition-section" class="mt-12"></div>

                    <div class="mt-12 flex flex-col sm:flex-row justify-center items-center gap-4">
                        <button onclick="editInputs()" class="w-full sm:w-auto px-8 py-3 font-semibold text-white rounded-lg btn-secondary">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg>
                            Edit Inputs
                        </button>
                        <button id="downloadPdfButton" onclick="downloadPDF()" class="w-full sm:w-auto px-8 py-3 font-semibold text-white rounded-lg btn-primary">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            Download PDF
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- ─── PDF TEMPLATE (hidden) ─── -->
    <!-- Removed as the PDF will be generated directly using jsPDF's text and line drawing capabilities -->
    
    <!-- Footer -->
    <footer class="bg-gray-900 text-center py-8">
        <p class="text-gray-400">&copy; 2025 GymPlan. All Rights Reserved. Powered by AI.</p>
    </footer>

    <!-- Exercise Detail Modal -->
    <div id="exerciseModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <!-- Backdrop -->
        <div class="fixed inset-0 bg-black bg-opacity-75" onclick="closeExerciseModal()"></div>
        
        <!-- Modal Content -->
        <div class="bg-gray-800 rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col transform transition-all duration-300 ease-in-out">
            <div class="p-6 border-b border-gray-700 flex justify-between items-center">
                <h3 id="modalTitle" class="text-2xl font-bold text-white">Exercise Details</h3>
                <button onclick="closeExerciseModal()" class="text-gray-400 hover:text-white transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="p-6 flex-grow overflow-y-auto">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Video Player -->
                    <div>
                        <div class="aspect-w-16 aspect-h-9 bg-black rounded-lg">
                            <iframe id="modalVideo" class="w-full h-full rounded-lg" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                        </div>
                        <a id="youtubeLink" href="#" target="_blank" class="block text-center text-sm text-blue-400 hover:underline mt-2">Watch on YouTube if video is unavailable</a>
                    </div>
                    <!-- Instructions -->
                    <div>
                        <h4 class="text-xl font-semibold text-white mb-3">Instructions</h4>
                        <ul id="modalInstructions" class="list-decimal list-inside space-y-2 text-gray-300">
                            <!-- Instructions will be injected here -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>
        // --- Form Data ---
        const trainingDaysData = [1, 2, 3, 4, 5, 6, 7];
        const mainGoalsData = ['Muscle Gain', 'Fat Loss'];
        const subGoalsData = ['Science-Based', 'Intense'];
        const equipmentData = ['Commercial Gym', 'Dumbbells at Home', 'Calisthenics'];
        const genderData = ['Male', 'Female'];

        // --- State Management ---
        let currentStep = 1;
        const totalSteps = 4; // Updated to 4 steps
        let currentPlanData = null; // To store the generated plan for PDF download

        // --- DOM Elements ---
        const progressBar = document.getElementById('progress-bar');
        const form = document.getElementById('gymPlanForm');
        const planGeneratorSection = document.getElementById('plan-generator');
        const planOutputSection = document.getElementById('plan-output');
        const loaderContainer = document.getElementById('loader-container');
        const resultsContainer = document.getElementById('results-container');
        const planDetailsContainer = document.getElementById('plan-details');
        const nutritionSection = document.getElementById('nutrition-section');
        const trainingDaysContainer = document.getElementById('trainingDaysContainer');
        const mainGoalContainer = document.getElementById('mainGoalContainer');
        const subGoalContainer = document.getElementById('subGoalContainer');
        const subGoalOptions = document.getElementById('subGoalOptions');
        const equipmentContainer = document.getElementById('equipmentContainer');
        const genderContainer = document.getElementById('genderContainer');
        const exerciseModal = document.getElementById('exerciseModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalVideo = document.getElementById('modalVideo');
        const modalInstructions = document.getElementById('modalInstructions');
        const youtubeLink = document.getElementById('youtubeLink');
        const downloadPdfButton = document.getElementById('downloadPdfButton'); // Get the download button
        
        // PDF Template elements - Removed as they are no longer used for direct HTML rendering in PDF
        // const pdfTemplate = document.getElementById('pdf-template');
        // const pdfDate = document.getElementById('pdf-date');
        // const pdfSummaryGoal = document.getElementById('pdf-summary-goal');
        // const pdfSummaryDays = document.getElementById('pdf-summary-days');
        // const pdfSummaryStyle = document.getElementById('pdf-summary-style');
        // const pdfSummaryEquipment = document.getElementById('pdf-summary-equipment');
        // const pdfUserProfile = document.getElementById('pdf-user-profile');
        // const pdfSummaryAdjustments = document.getElementById('pdf-summary-adjustments');
        // const pdfWorkoutDays = document.getElementById('pdf-workout-days');
        // const pdfNutritionSection = document.getElementById('pdf-nutrition-section');
        // const pdfCalories = document.getElementById('pdf-calories');
        // const pdfProtein = document.getElementById('pdf-protein');
        // const pdfCarbs = document.getElementById('pdf-carbs');
        // const pdfFats = document.getElementById('pdf-fats');


        // --- Form Initialization ---
        function initializeForm() {
            trainingDaysContainer.innerHTML = trainingDaysData.map(day => `
                <div><input type="radio" id="day-${day}" name="trainingDays" value="${day}" class="hidden peer" required><label for="day-${day}" class="block text-center p-4 rounded-lg border border-gray-600 cursor-pointer peer-checked:border-blue-500 peer-checked:bg-blue-900/50">${day}</label></div>`).join('');
            mainGoalContainer.innerHTML = mainGoalsData.map(goal => `
                <div><input type="radio" id="mainGoal-${goal.replace(/ /g, '')}" name="mainGoal" value="${goal}" class="hidden peer" required><label for="mainGoal-${goal.replace(/ /g, '')}" class="block text-center p-4 rounded-lg border border-gray-600 cursor-pointer peer-checked:border-blue-500 peer-checked:bg-blue-900/50">${goal}</label></div>`).join('');
            equipmentContainer.innerHTML = equipmentData.map(equip => `
                <div><input type="radio" id="equip-${equip.replace(/ /g,'')}" name="equipment" value="${equip}" class="hidden peer" required><label for="equip-${equip.replace(/ /g,'')}" class="block text-center p-4 rounded-lg border border-gray-600 cursor-pointer peer-checked:border-blue-500 peer-checked:bg-blue-900/50">${equip}</label></div>`).join('');
            genderContainer.innerHTML = genderData.map(gender => `
                <div><input type="radio" id="gender-${gender}" name="gender" value="${gender}" class="hidden peer" required><label for="gender-${gender}" class="block text-center p-4 rounded-lg border border-gray-600 cursor-pointer peer-checked:border-blue-500 peer-checked:bg-blue-900/50">${gender}</label></div>`).join('');
        }
        
        document.addEventListener('DOMContentLoaded', initializeForm);

        // --- Event Listeners ---
        mainGoalContainer.addEventListener('change', (event) => {
            if (event.target.name === 'mainGoal') {
                subGoalContainer.classList.remove('hidden');
                subGoalOptions.innerHTML = subGoalsData.map(subGoal => `
                     <div><input type="radio" id="subGoal-${subGoal.replace(/ /g, '')}" name="subGoal" value="${subGoal}" class="hidden peer" required><label for="subGoal-${subGoal.replace(/ /g, '')}" class="block text-center p-4 rounded-lg border border-gray-600 cursor-pointer peer-checked:border-blue-500 peer-checked:bg-blue-900/50">${subGoal}</label></div>`).join('');
            }
        });

        // --- Navigation ---
        function smoothScroll(event) {
            event.preventDefault();
            const targetId = event.currentTarget.getAttribute("href");
            const targetElement = document.querySelector(targetId);
            if (targetElement) {
                manualSmoothScroll(targetElement);
            }
        }

        function manualSmoothScroll(element) {
            const targetPosition = element.offsetTop;
            const startPosition = window.pageYOffset;
            const distance = targetPosition - startPosition;
            const duration = 750; // milliseconds
            let start = null;

            window.requestAnimationFrame(step);

            function step(timestamp) {
                if (!start) start = timestamp;
                const progress = timestamp - start;
                const ease = progress / duration < 0.5 ? 2 * (progress / duration) * (progress / duration) : -1 + (4 - 2 * (progress / duration)) * (progress / duration);
                window.scrollTo(0, startPosition + distance * ease);
                if (progress < duration) window.requestAnimationFrame(step);
            }
        }

        function nextStep(step) {
            if (validateStep(currentStep)) {
                document.getElementById(`step-${currentStep}`).classList.remove('active');
                currentStep = step;
                document.getElementById(`step-${currentStep}`).classList.add('active');
                updateProgressBar();
            }
        }

        function prevStep(step) {
            document.getElementById(`step-${currentStep}`).classList.remove('active');
            currentStep = step;
            document.getElementById(`step-${currentStep}`).classList.add('active');
            updateProgressBar();
        }

        function updateProgressBar() {
            const progress = (currentStep / totalSteps) * 100;
            progressBar.style.width = `${progress}%`;
        }
        
        function validateStep(step) {
            const currentStepElement = document.getElementById(`step-${step}`);
            const inputs = currentStepElement.querySelectorAll('[required]');
            let isValid = true;
            for (const input of inputs) {
                if ((input.type === 'radio' || input.type === 'checkbox')) {
                    const groupName = input.name;
                    const groupContainer = input.closest('.form-step');
                    if (groupContainer && window.getComputedStyle(groupContainer).display === 'none') continue;
                    if (!document.querySelector(`input[name="${groupName}"]:checked`)) {
                        isValid = false;
                        break;
                    }
                } else if (!input.value) {
                    isValid = false;
                    break;
                }
            }
            if (!isValid) alert('Please fill out all required fields before proceeding.');
            return isValid;
        }

        function editInputs() {
            planOutputSection.classList.add('hidden');
            planGeneratorSection.classList.remove('hidden');
            resultsContainer.classList.add('hidden');
            loaderContainer.classList.remove('hidden');
            planDetailsContainer.innerHTML = '';
            nutritionSection.innerHTML = '';
        }

        // --- Form Submission & API Call ---
        form.addEventListener('submit', async function(event) {
            event.preventDefault();
            
            const formData = new FormData(form);
            const mainGoal = formData.get('mainGoal');
            const subGoal = formData.get('subGoal');
            const combinedGoal = `${subGoal} ${mainGoal}`;

            const data = {
                days: formData.get('trainingDays'),
                goal: combinedGoal,
                gender: formData.get('gender'),
                height: formData.get('height'),
                weight: formData.get('weight'),
                equipment: formData.get('equipment'),
                style: formData.get('trainingStyle'),
                limitations: formData.get('limitations'),
            };

            planGeneratorSection.classList.add('hidden');
            planOutputSection.classList.remove('hidden');
            manualSmoothScroll(planOutputSection);

            try {
                const prompt = `
You are a certified strength and conditioning coach, clinical exercise physiologist, and precision nutrition expert.

Your job is to return a fully customized **weekly training and meal plan**, built around the user's input. The response must be **strictly formatted** as a valid JSON object. No markdown, no text, no headers — only JSON.

-------------------
✅ JSON STRUCTURE (Strictly Follow):
{
  "plan": [
    {
      "day": "Day 1",
      "focus": "Pull (Back, Biceps)",
      "exercises": [
        {
          "name": "Dumbbell Bent-Over Row",
          "sets": 3,
          "reps": 10,
          "rest_seconds": 60,
          "notes": "Use moderate weight. Avoid jerking motion.",
          "youtube_search_query": "how to do dumbbell bent over row",
          "instructions": [
            "Hinge at your hips, keeping your back straight.",
            "Pull the dumbbells towards your lower chest.",
            "Squeeze your back muscles at the top."
          ]
        }
      ],
      "cardio": {
        "type": "MISS – Incline Walk",
        "duration_minutes": 30,
        "intensity": "Moderate (RPE 6/10)",
        "timing": "Post-weight training",
        "notes": "Supports fat loss via steady-state effort."
      }
    }
  ],
  "meals": {
    "daily_calories": 2100,
    "macros": {
      "protein_g": 160,
      "carbs_g": 180,
      "fats_g": 70
    }
  },
  "summary": {
    "goal": "Fat Loss",
    "style": "Push/Pull/Legs",
    "days_per_week": 5,
    "volume_type": "Low volume, high intensity",
    "equipment_used": ["Dumbbells", "Resistance Bands"],
    "adjustments": ["Avoid deep lunges due to mild knee discomfort"],
    "user_profile": {
      "sex": "Male",
      "age": 28,
      "weight_kg": 82,
      "height_cm": 178
    }
  }
}
-------------------

✅ LOGIC RULES:
1. Each exercise must include: "name", "sets", "reps", "rest_seconds", "notes", "youtube_search_query", and "instructions" (minimum 3 clear steps).
2. Match plan structure to user goal and training style.
   - Fat Loss → 6–10 reps, short rests (45–90 sec), cardio post-training (MISS or HIIT)
   - Muscle Gain → 6–8 reps, 3–5 sets, 75–90% 1RM, optional walking
   - Strength → 3–5 reps, long rest (2–4 min)
3. Always prioritize compound movements at the start of each workout.
4. Only use exercises compatible with available equipment.
5. Do not repeat the same exercises in the same week.
6. Match rest_seconds to rep scheme:
   - 3–5 reps → 120–180 sec
   - 6–10 reps → 60–90 sec
   - 12+ reps → 30–45 sec
7. Cardio logic:
   - Fat Loss → 20–40 min MISS or 10–20 min HIIT (post-weight)
   - Muscle Gain → 15–30 min light walking (optional)
   - Include cardio type, timing, duration, and RPE/notes
8. Mifflin-St Jeor for calories: 
   \`10 × weight_kg + 6.25 × height_cm − 5 × age + 5 (male)\`
   Multiply by 1.5 activity factor.
9. Macronutrient targets:
   - Protein: 1.8–2.2g/kg (fat loss), 2–2.5g/kg (muscle gain)
   - Fats: 25–30% of total calories
   - Carbs: remainder (calories − protein×4 − fat×9) ÷ 4
10. If notes include:
   - "knee issues" → avoid lunges, jump squats, deep squats
   - "short on time" → limit midweek sessions to ≤35 min
   - "morning sessions" → minimize warm-up, avoid fasted cardio
11. Return **only valid JSON** — no commentary, text, or markdown.

-------------------

✅ INPUT VARIABLES TO BE INJECTED:
- sex: \${JSON.stringify(data.gender)}
- weight_kg: \${data.weight}
- height_cm: \${data.height}
- age: 28
- days_per_week: \${data.days}
- goal: \${JSON.stringify(data.goal)}
- equipment: [\${data.equipment.map(eq => JSON.stringify(eq)).join(", ")}]
- style: \${JSON.stringify(data.style || 'Not specified, choose best fit')}
- notes: \${JSON.stringify(data.limitations || 'None')}
`;



                let resultText = await callGeminiAPI(prompt);
                const startIndex = resultText.indexOf('{');
                const endIndex = resultText.lastIndexOf('}');
                if (startIndex !== -1 && endIndex !== -1 && endIndex > startIndex) {
                    resultText = resultText.substring(startIndex, endIndex + 1);
                }
                const resultJson = JSON.parse(resultText);
                currentPlanData = resultJson;
                displayPlan(resultJson);
            } catch (error) {
                console.error("Error generating plan:", error);
                alert("Sorry, we couldn't generate your plan. The AI response was not in the correct format. Please try again.");
            } finally {
                loaderContainer.classList.add('hidden');
                resultsContainer.classList.remove('hidden');
            }
        });

        async function callGeminiAPI(prompt) {
            const functionUrl = '/api/generate-plan'; // Assuming this is handled by a backend function
            const response = await fetch(functionUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt: prompt })
            });
            if (!response.ok) throw new Error(`Function call failed with status: ${response.status}`);
            const result = await response.json();
            if (result.candidates && result.candidates.length > 0) return result.candidates[0].content.parts[0].text;
            throw new Error("Failed to parse the plan from the API response.");
        }
        
        async function swapExercise(dayIndex, exIndex, buttonElement) {
            const originalButtonContent = buttonElement.innerHTML;
            buttonElement.innerHTML = `<div class="swap-loader"></div>`;
            buttonElement.disabled = true;
            try {
                const exerciseToSwap = currentPlanData.plan[dayIndex].exercises[exIndex];
                const formData = new FormData(form);
                const equipment = formData.get('equipment');
                const swapPrompt = `Provide a single suitable alternative exercise for "${exerciseToSwap.name}". The user has access to a "${equipment}". Return a single valid JSON object for the new exercise, with no explanation. The JSON object must have the exact same structure as the original: { "name": "...", "sets": ..., "reps": ..., "rest_seconds": ..., "notes": "...", "youtube_search_query": "...", "instructions": ["..."] }. Original exercise for context: ${JSON.stringify(exerciseToSwap)}`;
                let resultText = await callGeminiAPI(swapPrompt);
                const startIndex = resultText.indexOf('{');
                const endIndex = resultText.lastIndexOf('}');
                if (startIndex !== -1 && endIndex !== -1 && endIndex > startIndex) {
                    resultText = resultText.substring(startIndex, endIndex + 1);
                }
                const newExercise = JSON.parse(resultText);
                currentPlanData.plan[dayIndex].exercises[exIndex] = newExercise;
                displayPlan(currentPlanData);
            } catch (error) {
                console.error("Error swapping exercise:", error);
                alert("Could not swap the exercise. Please try again.");
                buttonElement.innerHTML = originalButtonContent;
            } finally {
                buttonElement.disabled = false;
            }
        }

        // --- UI Display ---
        function displayPlan(data) {
            const { plan, meals } = data;
            planDetailsContainer.innerHTML = '';
            nutritionSection.innerHTML = '';

            plan.forEach((day, dayIndex) => {
                const exercisesHtml = day.exercises.map((ex, exIndex) => `
                    <li class="py-3 border-b border-gray-700 last:border-b-0">
                        <div class="flex justify-between items-center gap-2 flex-wrap">
                            <span class="font-semibold text-white">${ex.name} <button onclick="openExerciseModal(${dayIndex}, ${exIndex})" class="text-blue-400 hover:underline text-xs ml-1 font-normal">(view instructions)</button></span>
                            <div class="flex items-center gap-4 flex-shrink-0">
                               <p class="text-blue-400 font-semibold text-right whitespace-nowrap">${ex.sets} x ${ex.reps} reps</p>
                               <button onclick="swapExercise(${dayIndex}, ${exIndex}, this)" class="text-xs bg-gray-600 hover:bg-gray-500 rounded-full px-2 py-1 transition">Swap</button>
                            </div>
                        </div>
                        <p class="text-sm text-gray-400 mt-1">Rest: ${ex.rest_seconds}s. ${ex.notes || ''}</p>
                    </li>`).join('');
                planDetailsContainer.innerHTML += `<div class="plan-card"><h4 class="text-xl font-bold text-blue-400">${day.day}</h4><h5 class="text-lg font-semibold mb-4 text-white">${day.focus}</h5><ul class="space-y-2 flex-grow">${exercisesHtml}</ul></div>`;
            });

            if (meals && meals.macros) {
                const macros = meals.macros;
                nutritionSection.innerHTML = `
                    <div class="nutrition-card mt-12">
                        <h3 class="text-3xl font-bold text-center text-white mb-6">AI Nutrition Guidance</h3>
                        <div class="grid grid-cols-1 gap-6 text-center">
                            <div class="bg-gray-800 p-6 rounded-xl">
                                <p class="text-lg text-gray-400">Calories</p>
                                <p class="text-4xl font-bold text-blue-400">${macros.daily_calories || meals.daily_calories} kcal</p>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
                                <div class="bg-gray-800 p-6 rounded-xl">
                                    <p class="text-lg text-gray-400">Protein</p>
                                    <p class="text-4xl font-bold text-blue-400">${macros.protein_g}g</p>
                                </div>
                                <div class="bg-gray-800 p-6 rounded-xl">
                                    <p class="text-lg text-gray-400">Carbs</p>
                                    <p class="text-4xl font-bold text-blue-400">${macros.carbs_g}g</p>
                                </div>
                                <div class="bg-gray-800 p-6 rounded-xl">
                                    <p class="text-lg text-gray-400">Fats</p>
                                    <p class="text-4xl font-bold text-blue-400">${macros.fats_g}g</p>
                                </div>
                            </div>
                        </div>
                    </div>`;
            }
        }
        
        // --- Modal Functions ---
        function openExerciseModal(dayIndex, exIndex) {
            if (!currentPlanData) return;
            const exercise = currentPlanData.plan[dayIndex].exercises[exIndex];
            modalTitle.textContent = exercise.name;
            const videoQuery = encodeURIComponent(exercise.youtube_search_query);
            modalVideo.src = `https://www.youtube.com/embed?listType=search&list=${videoQuery}`;
            youtubeLink.href = `https://www.youtube.com/results?search_query=${videoQuery}`;
            modalInstructions.innerHTML = exercise.instructions.map(step => `<li>${step}</li>`).join('');
            exerciseModal.classList.remove('hidden');
        }

        function closeExerciseModal() {
            exerciseModal.classList.add('hidden');
            modalVideo.src = '';
        }

        // --- Utility Functions ---
        function downloadPDF() {
            if (!currentPlanData) {
                alert("Please generate a plan first!");
                return;
            }

            const originalButtonContent = downloadPdfButton.innerHTML;
            downloadPdfButton.innerHTML = `<div class="swap-loader mr-2"></div> Generating...`;
            downloadPdfButton.disabled = true;

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });
            const { plan, summary, meals } = currentPlanData;

            let y = 20; // Current Y position on the page
            const pageMargin = 15; // Left/Right margin
            const lineSpacing = 4; // Vertical spacing between lines
            const sectionSpacing = 8; // Vertical spacing between sections
            const subSectionSpacing = 5; // Vertical spacing within sections (e.g., between exercise and cardio)
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            const usableWidth = pageWidth - (pageMargin * 2); // Width available for text

            // --- Header ---
            // Add logo (assuming logo.png.png is available in the root and jsPDF can access it)
            // Note: For actual deployment, ensure the image path is correct and accessible.
            // If the image doesn't load, you might need to convert it to base64 or provide a public URL.
            // For now, I'll use a placeholder if the image fails.
            try {
                // Attempt to load the image. This might not work directly in all environments
                // without a proper server setup or if the image is not base64 encoded.
                // For a robust solution, you'd convert logo.png.png to base64 and use that.
                const img = new Image();
                img.src = 'logo.png.png';
                img.onload = () => {
                    doc.addImage(img, 'PNG', pageMargin, y - 5, 15, 15); // x, y, width, height
                };
                // Adding a small delay to allow image to load before text, though not guaranteed
                // For production, consider using Promise.all with image loading or base64.
            } catch (e) {
                console.warn("Could not load logo image for PDF, proceeding without it.", e);
            }
            
            doc.setFont("helvetica", "bold");
            doc.setTextColor(30, 30, 30); // Dark gray for text
            doc.setFontSize(18);
            doc.text("GymPlan.fit", pageMargin + 18, y + 5); // Adjust X for logo
            y += 10;

            doc.setFontSize(10);
            doc.setFont("helvetica", "normal");
            doc.text("Generated Training & Meal Plan", pageMargin, y);
            y += lineSpacing;

            doc.setFontSize(8);
            doc.text(`Date: ${new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}`, pageMargin, y);
            y += sectionSpacing * 2; // Extra space after header

            // --- Plan Summary Section ---
            doc.setDrawColor(200); // Light gray line
            doc.line(pageMargin, y, pageWidth - pageMargin, y);
            y += sectionSpacing;

            doc.setFontSize(12);
            doc.setFont("helvetica", "bold");
            doc.text("Plan Summary", pageMargin, y);
            y += sectionSpacing;

            doc.setFontSize(9);
            doc.setFont("helvetica", "normal");
            doc.text(`Goal: ${summary.goal}`, pageMargin, y);
            doc.text(`Days per Week: ${summary.days_per_week}`, pageMargin + usableWidth / 2, y);
            y += lineSpacing;
            doc.text(`Training Style: ${summary.style}`, pageMargin, y);
            doc.text(`Equipment: ${summary.equipment_used.join(', ')}`, pageMargin + usableWidth / 2, y);
            y += lineSpacing;
            doc.text(`User Profile: ${summary.user_profile.sex}, ${summary.user_profile.age} years old, ${summary.user_profile.height_cm}cm, ${summary.user_profile.weight_kg}kg`, pageMargin, y);
            y += lineSpacing;
            doc.text(`Adjustments: ${summary.adjustments.length > 0 ? summary.adjustments.join(', ') : 'None'}`, pageMargin, y);
            y += sectionSpacing * 1.5; // Space after summary

            // --- Per-Day Workout Sections ---
            plan.forEach((day, index) => {
                // Add new page if current content won't fit
                if (y + 50 > pageHeight) { // Estimate space needed for a new day section
                    doc.addPage();
                    y = 20; // Reset Y for new page
                }

                doc.setDrawColor(200); // Light gray line
                doc.line(pageMargin, y, pageWidth - pageMargin, y);
                y += sectionSpacing;

                doc.setFontSize(11);
                doc.setFont("helvetica", "bold");
                doc.text(`${day.day}: ${day.focus}`, pageMargin, y);
                y += subSectionSpacing;

                day.exercises.forEach(ex => {
                    if (y + 25 > pageHeight) { // Estimate space needed for an exercise block
                        doc.addPage();
                        y = 20;
                    }
                    doc.setFontSize(9);
                    doc.setFont("helvetica", "bold");
                    doc.text(ex.name, pageMargin + 2, y); // Slightly indented
                    y += lineSpacing;

                    doc.setFontSize(8);
                    doc.setFont("helvetica", "normal");
                    doc.text(`Sets: ${ex.sets}x${ex.reps} | Rest: ${ex.rest_seconds}s`, pageMargin + 5, y); // Further indented
                    y += lineSpacing;

                    doc.setFontSize(8);
                    doc.setFont("helvetica", "italic");
                    const notesLines = doc.splitTextToSize(`Notes: ${ex.notes || 'None'}`, usableWidth - 10); // Adjust width for indent
                    doc.text(notesLines, pageMargin + 5, y);
                    y += (notesLines.length * lineSpacing);

                    doc.setFontSize(8);
                    doc.setFont("helvetica", "normal");
                    doc.text("Instructions:", pageMargin + 5, y);
                    y += lineSpacing;
                    ex.instructions.forEach(inst => {
                        const instLines = doc.splitTextToSize(`• ${inst}`, usableWidth - 15); // Indent for bullet points
                        doc.text(instLines, pageMargin + 8, y);
                        y += (instLines.length * lineSpacing);
                    });
                    y += subSectionSpacing; // Space after each exercise
                });

                // Cardio section for the day
                if (day.cardio) {
                    if (y + 20 > pageHeight) { // Estimate space needed for cardio block
                        doc.addPage();
                        y = 20;
                    }
                    doc.setFontSize(10);
                    doc.setFont("helvetica", "bold");
                    doc.text("Cardio", pageMargin, y);
                    y += subSectionSpacing;

                    doc.setFontSize(8);
                    doc.setFont("helvetica", "normal");
                    doc.text(`Type: ${day.cardio.type}`, pageMargin + 2, y);
                    y += lineSpacing;
                    doc.text(`Duration: ${day.cardio.duration_minutes} min`, pageMargin + 2, y);
                    y += lineSpacing;
                    doc.text(`Intensity: ${day.cardio.intensity}`, pageMargin + 2, y);
                    y += lineSpacing;
                    doc.text(`Timing: ${day.cardio.timing}`, pageMargin + 2, y);
                    y += lineSpacing;
                    const cardioNotesLines = doc.splitTextToSize(`Notes: ${day.cardio.notes || 'None'}`, usableWidth - 10);
                    doc.text(cardioNotesLines, pageMargin + 2, y);
                    y += (cardioNotesLines.length * lineSpacing);
                    y += sectionSpacing;
                }
            });

            // --- Daily Nutrition Summary ---
            if (meals && meals.macros) {
                if (y + 50 > pageHeight) { // Estimate space needed for nutrition section
                    doc.addPage();
                    y = 20;
                }
                doc.setDrawColor(200); // Light gray line
                doc.line(pageMargin, y, pageWidth - pageMargin, y);
                y += sectionSpacing;

                doc.setFontSize(12);
                doc.setFont("helvetica", "bold");
                doc.text("Daily Nutrition Summary", pageMargin, y);
                y += sectionSpacing;

                doc.setFontSize(9);
                doc.setFont("helvetica", "normal");
                doc.text(`Total Calories: ~${meals.macros.daily_calories || meals.daily_calories} kcal`, pageMargin, y);
                doc.text(`Protein: ~${meals.macros.protein_g}g`, pageMargin + usableWidth / 2, y);
                y += lineSpacing;
                doc.text(`Carbs: ~${meals.macros.carbs_g}g`, pageMargin, y);
                doc.text(`Fats: ~${meals.macros.fats_g}g`, pageMargin + usableWidth / 2, y);
                y += sectionSpacing;
            }

            doc.save('GymPlan.pdf');

            // Restore button state
            downloadPdfButton.innerHTML = originalButtonContent;
            downloadPdfButton.disabled = false;
        }

    </script>
</body>
</html>
